---
output:
  html_document:
    theme: sandstone
params: 
    set_title: !r paste("Kontroll av PJS-data for:", purpose, aar)
title: "`r params$set_title`"
---
```{r set-options, echo=FALSE, cache=FALSE}
options(width = 1000)
```

```{r setup, include=FALSE}

# Attach packages
library(NVIbatch)
use_pkg(pkg = c("dplyr", "tidyr", "knitr", "kableExtra"))
use_NVIverse(pkg = c("NVIdb", "OKcheck"))

# Global variables
# For use in filenames
today <- format(Sys.Date(), "%Y%m%d")

# Import support data
# Translation table for PJS-codes
PJS_codes_2_text <- NVIdb::read_PJS_codes_2_text()

# Table with accepted code combinations per OK-program (purpose)
accepted_codes <- openxlsx::read.xlsx(xlsxFile = paste0(NVIdb::set_dir_NVI("OKprogrammer"),
                                                        "OKstatistikkApp/Stottedata/Kontrolltabeller_PJS_", 
                                                        aar, 
                                                        ".xlsx"),
                                      detectDates = TRUE)

knitr::opts_chunk$set(echo=TRUE)
```


```{r, include = FALSE}
## Kontroll av PJS-data for: `r purpose` `r aar` per `r format(Sys.Date(), "%d.%m.%Y")`

```

<!-- Tabell I-1. Saker som ikke er avsluttet -->
```{r child=system.file('templates', "check_avsluttet.Rmd", package = "OKcheck")}
```

<!-- Tabell P-1. Saker med feil eller manglende art -->
```{r child=system.file('templates', "check_art.Rmd", package = "OKcheck")}
```

<!-- Tabell K-1. Saker med mer enn en sakskonklusjon for identiske saksanalytter -->
```{r child=system.file('templates', "check_doubble_sak_konkl.Rmd", package = "OKcheck")}
```

<!-- Tabell K-2. Sakskonklusjon uten tilsvarende provekonklusjon for minst en prove -->
```{r child=system.file('templates', "check_konkl_sak_u_prv.Rmd", package = "OKcheck")}
```

<!-- Tabell Kx-3. Positiv sakskonklusjon mangler nÃ¥r det er positiv provekonklusjon -->
```{r, include = FALSE}
kjennelsekode <- "020209"
analyttkode <- "01150101070103"
```

```{r child=system.file('templates', "check_konkl_sak_when_pos_prv.Rmd", package = "OKcheck")}
```

<!-- Tabell Kx-3. Positiv sakskonklusjon mangler nar det er positiv provekonklusjon -->
```{r, include = FALSE}
kjennelsekode <- "020209"
analyttkode <- "01190108"
```

```{r child=system.file('templates', "check_konkl_sak_when_pos_prv.Rmd", package = "OKcheck")}
```

<!-- Tabell K-4. Prover med mer enn en provekonklusjon for identiske proveanalytter -->
```{r child=system.file('templates', "check_doubble_prv_konkl.Rmd", package = "OKcheck")}
```

<!-- Tabell Tabell K-5. Prover med forelopig konklusjon -->
```{r child=system.file('templates', "check_forelopig_konkl.Rmd", package = "OKcheck")}
```

<!-- Tabell Tabell K-7. Positivt resultat mangler nar det er positiv provekonklusjon -->
```{r child=system.file('templates', "check_res_when_pos_prv.Rmd", package = "OKcheck")}
```

